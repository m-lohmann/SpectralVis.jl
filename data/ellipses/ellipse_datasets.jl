#= 
    sources:

    Journal of the Optical Society of America

    Günter Wyszecki & G. H. Fiedler: New Color-Matching Ellipses, 1971

    Color matching data were obtained by the following observers:

    DLM: David L. MacAdam (after Brown & MacAdam)
    PGN: P.G. Nutting Jr.
    WRB: W. R. J. Brown (after Brown & MacAdam)
    GW: 42 years old observer
    AR: 27 years old observer
    GF: 32 years old observer
    B(original name 12B): Average ellipses of W. R. J. Brown’s group of 12 observers
    FMC: predicted ellipses by the Friele-MacAdam-Chickering formula optimized for best fit with PGN ellipses.
=#
#=

    All data are given in Yxy color space coordinates!

=#


# experiment luminance data in [cd/m²]
#  background | test field
const ELLIPSE_LUMINANCE_DATA =
    #PGN_bg, PGN_lum
   [24.0     48.0;
    #WSS_bg, WSS_lum
    24.0     48.0;
    #FMC_bg, FMC_lum
    24.0     48.0;
    #WRB_bg, WRB_lum
    0.0     999.0;
    #DLM
    0.0     999.0;
    #12B
    8.9     999.0;
    #GF
    6.0      12.0;
    #AR
    6.0      12.0;
    #GW
    6.0      12.0]







# MacAdam color matching ellipses obtained by observer
# P.G. Nutting Jr., which refer to 2° test colors.
# L0 = Y0 ≈ 48 cd/m² surrounded by a 42° white surround
# with a luminance of ≈ 24 cd/m².

# Ellipses refer to standard deviations of color matches
# Estimated by MacAdam to be ~1/3 of the corresponding JND

    #  x0  y0    θ(deg)    a        b
const PGN_ellipses =
   [0.160  0.057   62.5  0.85e-03  0.35e-03;
    0.187  0.118   77.0  2.20e-03  0.55e-03;
    0.253  0.125   55.5  2.50e-03  0.50e-03;
    0.150  0.680  105.0  9.60e-03  2.30e-03;
    0.131  0.521  112.5  4.70e-03  2.00e-03;
    0.212  0.550  100.0  5.80e-03  2.30e-03;
    0.258  0.450   92.0  5.00e-03  2.00e-03;
    0.152  0.365  110.0  3.80e-03  1.90e-03;
    0.280  0.385   75.5  4.00e-03  1.50e-03;
    0.380  0.498   70.0  4.40e-03  1.20e-03;
    0.160  0.200  104.0  2.10e-03  0.95e-03;
    0.228  0.250   72.0  3.10e-03  0.90e-03;
    0.305  0.323   58.0  2.30e-03  0.90e-03;
    0.385  0.303   65.5  3.80e-03  1.60e-03;
    0.472  0.399   51.0  3.20e-03  1.40e-03;
    0.527  0.350   20.0  2.60e-03  1.30e-03;
    0.475  0.300   28.5  2.90e-03  1.10e-03;
    0.510  0.236   29.5  2.40e-03  1.20e-03;
    0.596  0.283   13.0  2.60e-03  1.30e-03;
    0.344  0.284   60.0  2.30e-03  0.90e-03;
    0.390  0.237   47.0  2.50e-03  1.00e-03;
    0.441  0.198   34.5  2.80e-03  0.95e-03;
    0.278  0.223   57.5  2.40e-03  0.55e-03;
    0.300  0.163   54.0  2.90e-03  0.60e-03;
    0.365  0.153   40.0  3.60e-03  0.95e-03] 


    #WSS ellipses are threshold loci based on a 50% chance of seeing a color difference.

    #  x0  y0    θ(deg)    a        b
const WSS_ellipses =
   [0.160  0.057   85.5   2.4e-03   1.4e-03;
    0.187  0.118   76.8   6.3e-03   2.9e-03;
    0.253  0.125   53.4   7.4e-03   2.8e-03;
    0.150  0.680  116.6  24.2e-03  11.4e-03;
    0.131  0.521  105.3  22.6e-03  10.3e-03;
    0.212  0.550  105.7  19.4e-03  10.9e-03;
    0.258  0.450   91.3  16.3e-03   9.9e-03;
    0.152  0.365   97.0  17.8e-03   7.6e-03;
    0.280  0.385   79.9  14.8e-03   8.8e-03;
    0.380  0.498  110.0  12.8e-03   9.6e-03;
    0.160  0.200   92.0  11.2e-03   4.5e-03;
    0.228  0.250   76.7  12.6e-03   5.9e-03;
    0.305  0.323   68.0  13.5e-03   7.4e-03;
    0.385  0.303   65.8  12.2e-03   8.6e-03;
    0.472  0.399   55.4   9.5e-03   8.0e-03;
    0.527  0.350   38.4   8.8e-03   6.1e-03;
    0.475  0.300   41.5  10.9e-03   5.3e-03;
    0.510  0.236   34.3  10.9e-03   3.2e-03;
    0.596  0.283   31.0   8.3e-03   3.5e-03;
    0.344  0.284   56.7  12.6e-03   6.2e-03;
    0.390  0.237   45.3  11.8e-03   4.5e-03;
    0.441  0.198   36.4  11.4e-03   2.9e-03;
    0.278  0.223   62.1  11.5e-03   5.1e-03;
    0.300  0.163   49.6   9.7e-03   3.4e-03;
    0.365  0.153   38.8  10.1e-03   2.5e-03]

    #  x0  y0    θ(deg)    a        b
const FMC_ellipses =
   [0.160  0.057   76.4  0.85e-03  0.35e-03;
    0.187  0.118   72.0  2.00e-03  0.53e-03;
    0.253  0.125   53.5  2.30e-03  0.49e-03;
    0.150  0.680  100.5  7.30e-03  3.10e-03;
    0.131  0.521  100.3  5.60e-03  2.60e-03;
    0.212  0.550   91.1  5.20e-03  2.40e-03;
    0.258  0.450   80.4  4.10e-03  1.80e-03;
    0.152  0.365   92.4  4.30e-03  1.80e-03;
    0.280  0.385   73.3  3.60e-03  1.40e-03;
    0.380  0.498   68.9  4.00e-03  1.70e-03;
    0.160  0.200   85.7  3.00e-03  1.00e-03;
    0.228  0.250   72.8  3.20e-03  0.99e-03;
    0.305  0.323   65.5  3.30e-03  1.10e-03;
    0.385  0.303   61.2  3.30e-03  1.30e-03;
    0.472  0.399   53.1  3.10e-03  1.40e-03;
    0.527  0.350   43.5  2.80e-03  1.40e-03;
    0.475  0.300   43.4  2.80e-03  1.20e-03;
    0.510  0.236   32.8  2.70e-03  1.20e-03;
    0.596  0.283   27.8  2.40e-03  1.50e-03;
    0.344  0.284   56.9  3.10e-03  0.97e-03;
    0.390  0.237   46.1  2.90e-03  0.94e-03;
    0.441  0.198   35.5  2.90e-03  1.00e-03;
    0.278  0.223   61.2  3.00e-03  0.79e-03;
    0.300  0.163   49.8  2.70e-03  0.64e-03;
    0.365  0.153   38.1  2.80e-03  0.77e-03]


#=  l0 = 0.2 * log10(Y0), with Y0 ≡ L0 in cd/m²
    Y0 = 10^(5 * l0) cd/m²

    based on ds² =  1
    Colors of varying lightness presented in a dark surround.
=#

    # x0     y0    l0     θ       a       b
const WRB_ellipses =
   [0.580  0.341  0.253  171  3.0e-03  1.6e-03;
    0.422  0.330  0.260   40  2.8e-03  1.3e-03;
    0.364  0.505  0.243   67  2.4e-03  1.1e-03;
    0.370  0.218  0.195   35  2.7e-03  1.0e-03;
    0.492  0.446  0.212   32  1.7e-03  1.3e-03;
    0.308  0.424  0.201   72  2.8e-03  0.8e-03;
    0.446  0.450  0.260   49  1.6e-03  1.1e-03;
    0.319  0.581  0.230   90  2.3e-03  1.5e-03;
    0.682  0.302  0.264  156  1.3e-03  0.6e-03;
    0.650  0.292  0.265    1  1.6e-03  0.8e-03;
    0.314  0.183  0.097   39  2.8e-03  0.8e-03;
    0.221  0.148  0.055   46  1.2e-03  0.4e-03;
    0.668  0.317  0.185  164  1.9e-03  1.1e-03;
    0.484  0.267  0.113   29  3.0e-03  1.1e-03;
    0.436  0.366  0.211   17  2.7e-03  1.1e-03;
    0.525  0.390  0.199    0  2.1e-03  1.5e-03;
    0.552  0.290  0.240   17  2.7e-03  1.1e-03;
    0.249  0.204  0.100   61  2.5e-03  1.0e-03;
    0.258  0.325  0.165   79  3.1e-03  1.3e-03;
    0.268  0.322  0.168   66  3.0e-03  0.9e-03;
    0.310  0.288  0.160   61  2.8e-03  1.1e-03;
    0.255  0.255  0.131   69  2.5e-03  0.9e-03;
    0.383  0.489  0.280   90  1.8e-03  1.2e-03;
    0.323  0.558  0.265   93  3.2e-03  1.4e-03;
    0.354  0.358  0.267   43  2.7e-03  1.1e-03;
    0.416  0.236  0.231   40  1.8e-03  1.1e-03;
    0.312  0.317  0.265  176  1.8e-03  0.9e-03;
    0.473  0.317  0.313   27  1.6e-03  1.0e-03;
    0.358  0.230  0.220   42  2.3e-03  0.8e-03;
    0.321  0.491  0.245   92  2.7e-03  1.3e-03;
    0.294  0.367  0.258   78  2.1e-03  1.1e-03;
    0.294  0.367  0.006   69  5.5e-03  1.6e-03;
    0.385  0.400  0.275   62  2.0e-03  0.9e-03;
    0.199  0.524  0.139   97  5.1e-03  2.3e-03;
    0.212  0.642  0.135   98  8.3e-03  1.8e-03;
    0.203  0.419  0.146  107  3.9e-03  1.1e-03;
    0.171  0.189  0.188   92  2.3e-03  0.6e-03;
    0.191  0.329  0.152   86  3.6e-03  1.0e-03]


    # x0    y0     l0     θ      a         b
const DLM_ellipses =
   [0.580  0.341  0.253  159  3.0e-03  1.5e-03;
    0.422  0.330  0.260   25  2.9e-03  1.4e-03;
    0.364  0.505  0.243   58  2.8e-03  1.8e-03;
    0.370  0.218  0.195   24  2.8e-03  1.0e-03;
    0.492  0.446  0.212   18  2.0e-03  1.0e-03;
    0.308  0.424  0.201   56  2.3e-03  0.9e-03;
    0.446  0.450  0.260    3  1.7e-03  1.0e-03;
    0.319  0.581  0.230    0    1e-08    1e-08;
    0.682  0.302  0.264  150  1.3e-03  0.8e-03;
    0.650  0.292  0.265  174  1.7e-03  0.8e-03;
    0.314  0.183  0.097   32  2.5e-03  0.7e-03;
    0.221  0.148  0.055   46  1.2e-03  0.4e-03;
    0.668  0.317  0.185  162  2.0e-03  0.9e-03;
    0.484  0.267  0.113   13  2.7e-03  1.5e-03;
    0.436  0.366  0.211   22  1.3e-03  0.7e-03;
    0.525  0.390  0.199  168  2.3e-03  1.0e-03;
    0.552  0.290  0.240   16  2.6e-03  1.1e-03;
    0.249  0.204  0.100   56  2.3e-03  0.8e-03;
    0.258  0.325  0.165   56  2.1e-03  1.1e-03;
    0.268  0.322  0.168   59  1.8e-03  0.9e-03;
    0.310  0.288  0.160   51  2.0e-03  0.8e-03;
    0.255  0.255  0.131   60  2.4e-03  0.9e-03;
    0.383  0.489  0.280   78  2.0e-03  1.5e-03;
    0.323  0.558  0.265   83  2.4e-03  1.4e-03;
    0.354  0.358  0.267   43  2.1e-03  0.8e-03;
    0.416  0.236  0.231   35  3.2e-03  1.4e-03;
    0.312  0.317  0.265  143  2.1e-03  1.0e-03;
    0.473  0.317  0.313   18  2.3e-03  1.1e-03;
    0.358  0.230  0.220   35  3.0e-03  1.0e-03;
    0.321  0.491  0.245   71  2.2e-03  1.1e-03;
    0.294  0.367  0.258   61  2.2e-03  0.8e-03;
    0.294  0.367  0.006   69  3.5e-03  1.2e-03;
    0.385  0.400  0.275   38  1.6e-03  1.3e-03;
    0.199  0.524  0.139   90  3.0e-03  1.3e-03;
    0.212  0.642  0.135   83  5.2e-03  2.3e-03;
    0.203  0.419  0.146  106  4.2e-03  1.6e-03;
    0.171  0.189  0.188   89  2.3e-03  0.4e-03;
    0.191  0.329  0.152  100  2.3e-03  1.1e-03]


#The color-matching ellipses are cross sections through the centers of (weighted) mean color-matching ellipsoids determined by a group of 12 observers for 10° test colors of different luminances (l0 = 0.2 log10 Y0), with Y0 = L0 in cd/m²) presented in a large near-white surround with a luminance of 8.9 cd/m² (that is, l0 = 0.190). For details see Ref. 15 or 3. Test color (13) is identical to test color 13 except that its angular subtense is reduced to 2°. Test colors marked with a prime, e.g. 1', 2', etc. are within the chromaticity gamut of Fig. 2 of this paper.

    # x0     y0    l0     Θ    a    b
const B_ellipses =
   [0.308  0.280  0.240   67  2.1e-03  1.1e-03;
    0.339  0.493  0.268   88  3.7e-03  1.6e-03;
    0.426  0.219  0.238   43  2.3e-03  1.3e-03;
    0.536  0.411  0.264  169  2.9e-03  1.4e-03;
    0.457  0.368  0.248    4  1.9e-03  1.0e-03;
    0.288  0.630  0.247  104  5.4e-03  2.0e-03;
    0.254  0.456  0.236  112  1.8e-03  1.0e-03;
    0.674  0.308  0.252  169  1.8e-03  0.7e-03;
    0.209  0.137  0.202   77  2.3e-03  0.7e-03;
    0.340  0.178  0.211   65  2.3e-03  1.1e-03;
    0.422  0.483  0.236   86  3.4e-03  2.1e-03;
    0.262  0.343  0.241   47  1.8e-03  1.5e-03;
    0.368  0.352  0.267  165  1.9e-03  1.0e-03;
    0.643  0.304  0.230  175  2.4e-03  0.9e-03;
    0.385  0.546  0.241  128  4.3e-03  2.9e-03;
    0.270  0.549  0.247  127  4.5e-03  2.0e-03;
    0.308  0.307  0.263   35  1.8e-03  1.4e-03;
    0.562  0.252  0.227   14  2.0e-03  0.9e-03;
    0.217  0.606  0.255  128  6.0e-03  2.4e-03;
    0.196  0.293  0.245    6  2.4e-03  1.5e-03;
    0.161  0.410  0.248  158  3.0e-03  1.6e-03;
    0.257  0.202  0.234   40  2.8e-03  1.0e-03]

#=
    GF, WR, GW ellipses

    ds² = 7.81 chosen according to χ² for 3 deg. of freedom.
    On average, ellipsoids contain 95% of any random set
    of color matches.

=#




    # x0      y0    g11    g12   g22    g23    g33   g13    Θ      a       b
const GF_ellipses =
   [0.4786  0.4327   492   -275   717    114   459    39   34  5.0e-03  2.9e-03;
    0.3909  0.4375   690   -678   999   -568   853   270   39  7.2e-03  2.2e-03;
    0.4932  0.3462   146    123  2637  -1151  1678  -215  177  7.5e-03  1.7e-03;
    0.3079  0.3595  1999   -572  1014   -474  1372  -428   65  3.2e-03  1.9e-03;
    0.4458  0.4809   567   -355   372     74   542    37   53  8.8e-03  3.0e-03;
    0.4382  0.3417   379    109  2250   -531  1391  -368  177  4.6e-03  1.9e-03;
    0.3822  0.3372   698   -409  1634   -162  1142  -587   21  3.8e-03  2.1e-03;
    0.2295  0.2987  1017   -556  1447   -331   991   109   34  3.5e-03  2.1e-03;
    0.3310  0.2749  1292   -645   844   -526  1092   402   55  4.5e-03  2.1e-03;
    0.2766  0.2551  1928  -1350  2262   -651  1516   280   41  3.3e-03  1.5e-03;
    0.2054  0.2544  1134   -499  1372   -592  1369  -179   38  3.2e-03  2.1e-03;
    0.5868  0.3360   102     56   901   -196   416   -24  176  8.9e-03  2.9e-03;
    0.3545  0.4518  1162   -411   306   -144   656   253   68  7.6e-03  2.4e-03;
    0.2618  0.2912  3006  -1389  1085   -156   578    50   62  4.7e-03  1.4e-03;
    0.3101  0.3163  2118   -910  1280     34   949   -99   59  3.3e-03  1.7e-03;
    0.3251  0.3325  3514   -312  1674   -494  1722   593   81  2.2e-03  1.5e-03;
    0.2959  0.3009  2572   -510  1560   -812  1947  -124   67  2.4e-03  1.7e-03;
    0.3144  0.3355  4825  -1690  3441   -232  1746  1786   56  1.8e-03  1.1e-03;
    0.3425  0.5280   525   -132   131    -79  1426   207   73  9.3e-03  3.7e-03;
    0.3022  0.4725  1946   -489   296     -4   781    14   75  6.9e-03  1.9e-03;
    0.4873  0.3994   408   -108  1422   -246  1942  -294    6  4.4e-03  2.3e-03;
    0.5428  0.3776   223    -29  1107   -151  1981   -75    2  5.9e-03  2.7e-03;
    0.2670  0.4240   991   -238   330    214  1239  -212   72  5.6e-03  2.7e-03;
    0.3753  0.3867  1285   -868  1007   -162  1016  -134   50  5.4e-03  2.0e-03;
    0.5242  0.3140   157    171  1008   -244   513   -14  169  8.0e-03  2.7e-03;
    0.2730  0.3701  1490   -654   951    311   798  -392   56  3.9e-03  2.0e-03;
    0.4650  0.3122   265    142   950   -275   556  -221  169  5.7e-03  2.8e-03;
    0.4058  0.2909   425   -174  1536   -407   926  -286    9  4.4e-03  2.2e-03]

    # x0      y0    g11    g12   g22   g23    g33   g13   Θ      a       b
    const AR_ellipses=
   [0.4786  0.4327   345   -389   866   152   483  -149  28  7.5e-03  2.7e-03;
    0.3909  0.4375   646   -344   479   -53   269     6  52  6.1e-03  2.9e-03;
    0.4932  0.3462  1105  -1088  2251    41   635  -147  31  2.2e-03  1.6e-03;
    0.3079  0.3595  2454   -788   933  -100   668   516  67  3.6e-03  1.7e-03;
    0.4458  0.4809   636   -391   515    -7   590   102  49  6.6e-03  2.8e-03;
    0.4382  0.3417  1082   -329  1573  -335  1226   456  27  2.9e-03  2.1e-03;
    0.3822  0.3372   771   -696  1442   273   986  -283  32  4.8e-03  2.0e-03;
    0.2295  0.2987  1684    652   958  -198  1129   135  60  3.7e-03  1.9e-03;
    0.3310  0.2749  1874  -1127  2103   -51  1026   358  42  3.0e-03  1.6e-03;
    0.2766  0.2551  4476  -1596  1181   124   577   -14  68  3.8e-03  1.2e-03;
    0.2054  0.2544  1448   -429   485  -109  1106     3  66  4.0e-03  2.2e-03;
    0.5868  0.3360   325    -14  1324   260   444   133   1  4.9e-03  2.4e-03;
    0.3545  0.4518  2537   -814   587  -163   721   488  70  5.2e-03  1.7e-03;
    0.2618  0.2912  2368  -1013  1011  -194   946   319  62  4.1e-03  1.6e-03;
    0.3101  0.3163  3291  -1049  1598    35   888   336  64  2.7e-03  1.4e-03;
    0.3251  0.3325  2718   -831  1565   220  1102   474  62  2.6e-03  1.6e-03;
    0.2959  0.3009  2387   -686  1110   142   815   -97  66  3.1e-03  1.7e-03;
    0.3144  0.3355  1639   -303   853   -85   708   196  71  3.2e-03  2.1e-03;
    0.3425  0.5280  1566   -242   182   -58   630   360  80  7.4e-03  2.2e-03;
    0.3022  0.4725  1835    -14   180   102  1025   761  90  6.6e-03  2.1e-03;
    0.4873  0.3994   516   -279   911   310   555   -84  27  4.6e-03  2.7e-03;
    0.5428  0.3776   335    -49  1130   341   447    24   4  4.8e-03  2.6e-03;
    0.2670  0.4240  1723   -169   206   -13   683   291  84  6.4e-03  2.1e-03;
    0.3753  0.3867  1160   -596   917  -312  1058    17  51  4.3e-03  2.2e-03;
    0.5242  0.3140   241    -94   692   178   587    63  11  5.9e-03  3.3e-03;
    0.2730  0.3701  1836   -459   577   -63   464    -3  72  4.3e-03  2.0e-03;
    0.4650  0.3122   383   -143   788  -107   677   -95  18  4.8e-03  3.1e-03;
    0.4058  0.2909   613   -447   815   -73   176   198  39  5.5e-03  2.6e-03]

    # x0      y0    g11    g12   g22   g23    g33   g13   Θ      a       b
    const GW_ellipses=
   [0.4786  0.43273  674   -695  1176    34   773    -6  35  5.5e-03  2.2e-03;
    0.3909  0.43753 1492  -1042  1251  -104   577   252  48  4.9e-03  1.8e-03;
    0.4932  0.34623  118     30  1491   -46  1501   136 179  8.2e-03  2.3e-03;
    0.3079  0.35953 1938   -629  1054  -268   751   382  63  3.3e-03  1.9e-03;
    0.4458  0.48093  692   -393   540    -1   668   144  50  6.0e-03  2.8e-03;
    0.4382  0.34173  532    -75  1328   113   689    56   5  3.9e-03  2.4e-03;
    0.3822  0.33723 1185  -1092  2074    -1   816   -67  34  4.2e-03  1.7e-03;
    0.2295  0.29873 1628   -508  1089  -741  3695    61  59  3.2e-03  2.0e-03;
    0.3310  0.27493 1512   -859   936  -389   805    79  54  5.0e-03  1.9e-03;
    0.2766  0.25513 6793  -2841  1855  -593  1898  1591  65  3.7e-03  1.0e-03;
    0.2054  0.25443 1242   -249   482   -75   954   242  73  4.4e-03  2.4e-03;
    0.5868  0.33603   78     10  1025   184   454   -59 179 10.0e-03  2.8e-03;
    0.3545  0.45183 1342   -374   284   -40   529  -136  72  6.9e-03  2.3e-03;
    0.2618  0.29123 4691  -1527  1068  -127   295   211  70  3.9e-03  1.2e-03;
    0.3101  0.31633 3406  -1554  1641  -691  1930   739  60  3.3e-03  1.4e-03;
    0.3251  0.33253 2717  -1656  2146  -141   901   572  50  3.2e-03  1.4e-03;
    0.2959  0.30093 2365  -1215  1261  -499  1683   358  57  4.0e-03  1.6e-03;
    0.3144  0.33553 3426  -1759  1525   128   994   306  59  4.0e-03  1.3e-03;
    0.3425  0.52803  769   -181    85   -37   875   247  76 14.0e-03  3.1e-03;
    0.3022  0.47253 2192   -501   225   -52   717   487  77  8.6e-03  1.8e-03;
    0.4873  0.39943  223   -331   959   211  1034  -229  21  9.0e-03  2.7e-03;
    0.5428  0.37763  119    -65   573  -191   968  -108   8  8.4e-03  3.7e-03;
    0.2670  0.42403  965   -114   186    98  1546   366  82  6.8e-03  2.8e-03;
    0.3753  0.38673  857   -874  1396    19  1165   137  36  6.1e-03  2.0e-03;
    0.5242  0.31403  136    -58   559    -6   280   -88   8  7.8e-03  3.7e-03;
    0.2730  0.37013 1251    178   511   -71   875    70 103  4.1e-03  2.5e-03;
    0.4650  0.31223  177   -122   653   228   755   -69  14  7.3e-03  3.4e-03;
    0.4058  0.29093  441   -167   504  -199   794    94  40  5.1e-03  3.5e-03]